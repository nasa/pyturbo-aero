<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>glennopt.optimizers.nsga3_ml &mdash; GlennOPT 1.4.* documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> GlennOPT
          </a>
              <div class="version">
                1.4.*
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/installation.html#installation-via-pip">Installation via Pip</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/installation.html#installation-via-source">Installation via Source</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/optimizers.html">Optimizers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/optimizers.html#sode-single-objective-differential-evolution">SODE - Single Objective Differential Evolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/optimizers.html#nsga3-nsga-iii-non-dominated-sorting-genetic-algorithm">NSGA3 / NSGA-III- Non-Dominated Sorting Genetic Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/optimizers.html#nsga3-ml-non-dominated-sorting-genetic-algorithm-with-machine-learning-surrogate">NSGA3_ML - Non-Dominated Sorting Genetic Algorithm with Machine Learning Surrogate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/optimizers.html#nsopt-non-dominated-sorting-optimization-using-scipy">NSOPT - Non-Dominated sorting optimization using Scipy</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/base.html">GlennOPT base classes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/base.html#module-glennopt.base.individual">Individual Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/base.html#module-glennopt.base.optimizer">Optimizer Base Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/base.html#module-glennopt.base.parameter">Parameter Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/sode.html">Single Objective Differential Evolution (SODE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/nsga3.html">Non-dominated sorting genetic algorithm (NSGA-III)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/nsga3_ml.html">Non-dominated sorting genetic algorithm (NSGA-III) with Machine Learning Surrogate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/nsopt.html">Non-dominated sorting optmization with Scipy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/helpers.html">GlennOPT Helpers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/helpers.html#module-glennopt.helpers.convert_to_ndarray">Converting to Numpy Array</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/helpers.html#module-glennopt.helpers.copy">Copy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/helpers.html#module-glennopt.helpers.mutate">Mutations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/helpers.html#module-glennopt.helpers.non_dominated_sorting">Non Dominated Sorting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/helpers.html#module-glennopt.helpers.parallel_settings">Parallel Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/helpers.html#module-glennopt.helpers.population_distance">Population Distance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/helpers.html#module-glennopt.helpers.post_processing">Post Processing</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">GlennOPT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>glennopt.optimizers.nsga3_ml</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for glennopt.optimizers.nsga3_ml</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    adjoint - gradient based optimization </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">copy</span><span class="o">,</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">trange</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>
<span class="kn">from</span> <span class="nn">torch.optim</span> <span class="kn">import</span> <span class="n">LBFGS</span><span class="p">,</span> <span class="n">AdamW</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">..helpers</span> <span class="kn">import</span> <span class="n">MultiLayerLinear</span> 
<span class="kn">from</span> <span class="nn">..helpers</span> <span class="kn">import</span> <span class="n">diversity</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">mutation_parameters</span><span class="p">,</span> <span class="n">de_mutation_type</span><span class="p">,</span> <span class="n">simple</span><span class="p">,</span><span class="n">de_dmp</span><span class="p">,</span> <span class="n">de_best_1_bin</span><span class="p">,</span><span class="n">de_rand_1_bin</span>
<span class="kn">from</span> <span class="nn">..helpers</span> <span class="kn">import</span> <span class="n">uniform_reference_points</span><span class="p">,</span> <span class="n">sort_and_select_population</span>
<span class="kn">from</span> <span class="nn">..helpers</span> <span class="kn">import</span> <span class="n">evaluation_func</span><span class="p">,</span> <span class="n">transform_data</span><span class="p">,</span> <span class="n">compute_mse</span>
<span class="kn">from</span> <span class="nn">..base</span> <span class="kn">import</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Individual</span><span class="p">,</span> <span class="n">Optimizer</span>
<span class="kn">from</span> <span class="nn">.nsga3</span> <span class="kn">import</span> <span class="n">find_intercepts</span><span class="p">,</span> <span class="n">find_extreme_points</span>


<div class="viewcode-block" id="NSGA3_ML"><a class="viewcode-back" href="../../../modules/nsga3_ml.html#glennopt.optimizers.nsga3_ml.NSGA3_ML">[docs]</a><span class="k">class</span> <span class="nc">NSGA3_ML</span><span class="p">(</span><span class="n">Optimizer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">eval_command</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;python evaluation.py&quot;</span><span class="p">,</span> <span class="n">eval_folder</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Evaluation&quot;</span><span class="p">,</span> <span class="n">optimization_folder</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">single_folder_eval</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">overwrite_input_file</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linear_network</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">],</span><span class="n">epochs</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">train_test_split</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">pop_size</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span><span class="n">ml_evals</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The objective of adjoint is to find the minimum of the jacobian of the evaluation parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">            eval_command (str, optional): [description]. Defaults to &quot;python evaluation.py&quot;.</span>
<span class="sd">            eval_folder (str, optional): [description]. Defaults to &quot;Evaluation&quot;.</span>
<span class="sd">            optimization_folder (str, optional): Folder where the optimization and doe work should be stored in. Defaults to None.</span>
<span class="sd">            single_folder_eval (bool, optional): Evaluate within a single folder and not make a bunch of folders . Defaults to False.</span>
<span class="sd">            overwrite_input_file (bool, optional): whether or not to overwrite the input file with new data when restarting a simulation. Defaults to False.</span>
<span class="sd">            linear_network (list, optional): Size of MultiLinear network. Defaults to [128,256,256].</span>
<span class="sd">            epochs (int, optional): Number of epochs to train neural network for </span>
<span class="sd">            train_test_split (float, optional): Number of datapoints to be assigned to train and test</span>
<span class="sd">            pop_size (int, optional): Population size </span>
<span class="sd">            ml_evals(int, optional): Number of internal machine learning evaluations to perform before evaluating the next population</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;NSGA3_ML&quot;</span><span class="p">,</span><span class="n">eval_command</span><span class="o">=</span><span class="n">eval_command</span><span class="p">,</span><span class="n">eval_folder</span><span class="o">=</span><span class="n">eval_folder</span><span class="p">,</span> <span class="n">opt_folder</span><span class="o">=</span><span class="n">optimization_folder</span><span class="p">,</span><span class="n">single_folder_eval</span><span class="o">=</span><span class="n">single_folder_eval</span><span class="p">,</span><span class="n">overwrite_input_file</span><span class="o">=</span><span class="n">overwrite_input_file</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">individuals</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear_network</span> <span class="o">=</span> <span class="n">linear_network</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epochs</span> <span class="o">=</span> <span class="n">epochs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_test_split</span> <span class="o">=</span> <span class="n">train_test_split</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span> <span class="o">=</span> <span class="n">pop_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mutation_params</span> <span class="o">=</span> <span class="n">mutation_parameters</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_scalers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_scalers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_str</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features_str</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ml_evals</span> <span class="o">=</span> <span class="n">ml_evals</span>
    
    <span class="c1"># * Mutation Properties</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mutation_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get Mutation parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            mutation_parameters: parameter class describes the mutation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mutation_params</span>

    <span class="nd">@mutation_params</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">mutation_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v</span><span class="p">:</span><span class="n">mutation_parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setter for mutation parameters </span>

<span class="sd">        Args:</span>
<span class="sd">            v (mutation_parameters): class describing the mutation parameter s</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mutation_params</span> <span class="o">=</span> <span class="n">v</span>

<div class="viewcode-block" id="NSGA3_ML.train"><a class="viewcode-back" href="../../../modules/nsga3_ml.html#glennopt.optimizers.nsga3_ml.NSGA3_ML.train">[docs]</a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">individuals</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="n">Individual</span><span class="p">],</span><span class="n">retrain</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Trains the neural network to predict the output given an input </span>
<span class="sd">    </span>
<span class="sd">        Optimizer (LBFGS): </span>
<span class="sd">            https://johaupt.github.io/python/pytorch/neural%20network/optimization/pytorch_lbfgs.html </span>

<span class="sd">        Args:</span>
<span class="sd">            individuals (List[Individual]): [description]</span>
<span class="sd">            retrain (bool, Optional): (True) retrains the existing model on new data. (False) create a new model</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[float float]: Train Loss and test loss </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># * Normalizing the Data</span>
        <span class="k">if</span> <span class="n">retrain</span><span class="p">:</span> <span class="c1"># If we simply train it with more data then there&#39;s no reason create new normalization scalers</span>
            <span class="n">normalized_individuals</span><span class="p">,</span> <span class="n">label_scalers</span><span class="p">,</span> <span class="n">feature_scalers</span><span class="p">,</span> <span class="n">labels_str</span><span class="p">,</span> <span class="n">features_str</span> <span class="o">=</span> <span class="n">transform_data</span><span class="p">(</span><span class="n">individuals</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">label_scalers</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_scalers</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">normalized_individuals</span><span class="p">,</span> <span class="n">label_scalers</span><span class="p">,</span> <span class="n">feature_scalers</span><span class="p">,</span> <span class="n">labels_str</span><span class="p">,</span> <span class="n">features_str</span> <span class="o">=</span> <span class="n">transform_data</span><span class="p">(</span><span class="n">individuals</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_scalers</span> <span class="o">=</span> <span class="n">label_scalers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_scalers</span> <span class="o">=</span> <span class="n">feature_scalers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_str</span> <span class="o">=</span> <span class="n">labels_str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features_str</span> <span class="o">=</span> <span class="n">features_str</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ind</span><span class="o">.</span><span class="n">objectives</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">normalized_individuals</span><span class="p">]),</span><span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ind</span><span class="o">.</span><span class="n">eval_parameters</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">normalized_individuals</span><span class="p">]),</span><span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        
        <span class="c1"># Transform</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">features</span><span class="p">,</span><span class="n">labels</span><span class="p">))</span>
        <span class="n">test_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">))</span>
        <span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">test_size</span><span class="p">)</span>
        <span class="n">train_dataset</span><span class="p">,</span> <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">,</span><span class="n">train_size</span><span class="o">=</span><span class="n">train_size</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">train_dl</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">test_dl</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">,</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># * Defining the Model        </span>
        <span class="n">n_inputs</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">n_outputs</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">retrain</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">MultiLayerLinear</span><span class="p">(</span><span class="n">n_inputs</span><span class="p">,</span><span class="n">n_outputs</span><span class="p">,</span><span class="n">h_sizes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linear_network</span><span class="p">)</span>
            <span class="c1"># self.optimizer = LBFGS(self.model.parameters(), lr=0.0001,history_size=100, max_eval=int(20*1.25), max_iter=20)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">AdamW</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>

        <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epochs</span><span class="p">):</span>
            <span class="n">train_loss</span> <span class="o">=</span> <span class="mi">0</span> 
            <span class="n">n_train</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_dl</span><span class="p">):</span>
                <span class="n">batch_size</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
                <span class="n">y_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span> <span class="c1"># Zero gradients, backward pass, and update weights</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
                <span class="c1"># calculate the loss again for monitoring</span>
                <span class="n">train_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                <span class="n">n_train</span> <span class="o">+=</span> <span class="n">batch_size</span>
            
            <span class="n">test_loss</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">n_test</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_dl</span><span class="p">):</span>
                <span class="n">batch_size</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">test_loss</span> <span class="o">+=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                <span class="n">n_test</span> <span class="o">+=</span> <span class="n">batch_size</span>
            <span class="n">train_loss</span> <span class="o">/=</span> <span class="n">n_train</span>
            <span class="n">test_loss</span> <span class="o">/=</span> <span class="n">n_test</span>
        <span class="k">return</span> <span class="n">train_loss</span><span class="p">,</span> <span class="n">test_loss</span></div>
            <span class="c1"># print(f&quot;Epoch: {epoch + 1:02}/{self.epochs} Train Loss: {train_loss:.5e} Test Loss: {test_loss:.5e}&quot;)</span>
        
<div class="viewcode-block" id="NSGA3_ML.optimize_from_population"><a class="viewcode-back" href="../../../modules/nsga3_ml.html#glennopt.optimizers.nsga3_ml.NSGA3_ML.optimize_from_population">[docs]</a>    <span class="k">def</span> <span class="nf">optimize_from_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pop_start</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span><span class="n">n_generations</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads the values of a population, this can be a DOE or a previous evaluation</span>
<span class="sd">            Starts the optimization </span>

<span class="sd">            Inputs:</span>
<span class="sd">                pop_start (-1 for DOE), reads the population folder and starts at pop_start+1</span>
<span class="sd">                n_generations - number of generations to run for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># * Read in all the results of the DOE, this should be done by a single thread</span>
        <span class="c1"># Check restart file, if not read the population</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_history_file</span><span class="p">()</span>

        <span class="n">newIndividuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_calculation_folder</span><span class="p">()</span> <span class="c1"># Use all individuals, there&#39;s no restart file</span>
        <span class="n">newIndividuals</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">newIndividuals</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>  <span class="c1"># Flattens the list of lists</span>
        <span class="c1"># bounds = [(ep.min_value, ep.max_value) for ep in self.eval_parameters]</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">newIndividuals</span><span class="p">)</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Number of individuals in the restart file is less than the population size.&quot;</span>
                <span class="o">+</span> <span class="s2">&quot; lower the population size or increase the DOE count(if restarting from a DOE)&quot;</span><span class="p">)</span>

        <span class="c1"># Do this before going into the train loop. This part of the code should happen after a new population is evaluated </span>
        <span class="n">ref_points</span> <span class="o">=</span> <span class="n">uniform_reference_points</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">individuals</span><span class="p">,</span><span class="n">best_point</span><span class="p">,</span> <span class="n">worst_point</span><span class="p">,</span> <span class="n">extreme_points</span> <span class="o">=</span> <span class="n">sort_and_select_population</span><span class="p">(</span><span class="n">individuals</span><span class="o">=</span><span class="n">newIndividuals</span><span class="p">,</span><span class="n">reference_points</span><span class="o">=</span><span class="n">ref_points</span><span class="p">,</span> <span class="n">pop_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span><span class="p">)</span>
        <span class="n">all_individuals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span> 
        <span class="n">all_individuals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">individuals</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pop_start</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">pop_start</span><span class="o">+</span><span class="n">n_generations</span><span class="p">):</span>  <span class="c1"># Population Loop </span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_evals</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">newIndividuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__crossover_mutate__</span><span class="p">(</span><span class="n">individuals</span><span class="p">)</span> <span class="c1"># This becomes normal nsga3            </span>
            <span class="sd">&#39;&#39;&#39; </span>
<span class="sd">                Train a Neural network on Individuals. Initially this is all the individuals</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">train_loss</span><span class="p">,</span> <span class="n">test_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">all_individuals</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
            
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                Calculate new evaluation points using neural networks</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">pop_dist_ml</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">pop_diversity_ml</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span> 
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_evals</span><span class="p">):</span> <span class="c1"># perform nsga evaluations on the ML Model </span>
                <span class="n">newIndividuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__crossover_mutate__</span><span class="p">(</span><span class="n">individuals</span><span class="p">)</span>
                <span class="n">newIndividuals</span> <span class="o">=</span> <span class="n">evaluation_func</span><span class="p">(</span><span class="n">newIndividuals</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">label_scalers</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_scalers</span><span class="p">)</span>                
                <span class="n">pop_diversity_ml</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diversity</span><span class="p">(</span><span class="n">newIndividuals</span><span class="p">))</span>       <span class="c1"># Calculate diversity </span>
                <span class="n">pop_dist_ml</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distance</span><span class="p">(</span><span class="n">individuals</span><span class="p">,</span><span class="n">newIndividuals</span><span class="p">))</span> <span class="c1"># Calculate population distance between past and future</span>

                <span class="n">newIndividuals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">individuals</span><span class="p">)</span> <span class="c1"># add the previous population to the pool                                    </span>

                <span class="n">individuals</span><span class="p">,</span><span class="n">best_point</span><span class="p">,</span> <span class="n">worst_point</span><span class="p">,</span> <span class="n">extreme_points</span> <span class="o">=</span> <span class="n">sort_and_select_population</span><span class="p">(</span><span class="n">newIndividuals</span><span class="p">,</span><span class="n">ref_points</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span><span class="p">)</span> 

            <span class="c1"># Evaluate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_population</span><span class="p">(</span><span class="n">individuals</span><span class="p">,</span><span class="n">pop</span><span class="p">)</span>
            <span class="c1"># self.evaluate_population(newIndividuals,pop)</span>
            <span class="n">newIndividuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_population</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span>
            <span class="n">mse</span> <span class="o">=</span> <span class="n">compute_mse</span><span class="p">(</span><span class="n">individuals</span><span class="p">,</span><span class="n">newIndividuals</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mse </span><span class="si">{</span><span class="n">mse</span><span class="si">:</span><span class="s2">03e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Sort and select</span>
            <span class="n">pop_diversity</span> <span class="o">=</span> <span class="n">diversity</span><span class="p">(</span><span class="n">newIndividuals</span><span class="p">)</span>       <span class="c1"># Calculate diversity </span>
            <span class="n">pop_dist</span> <span class="o">=</span> <span class="n">distance</span><span class="p">(</span><span class="n">individuals</span><span class="p">,</span><span class="n">newIndividuals</span><span class="p">)</span> <span class="c1"># Calculate population distance between past and future</span>
            <span class="n">all_individuals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">newIndividuals</span><span class="p">))</span>
            <span class="n">newIndividuals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">individuals</span><span class="p">)</span> <span class="c1"># add the previous population to the pool                                                </span>
            <span class="n">individuals</span><span class="p">,</span><span class="n">best_point</span><span class="p">,</span> <span class="n">worst_point</span><span class="p">,</span> <span class="n">extreme_points</span> <span class="o">=</span> <span class="n">sort_and_select_population</span><span class="p">(</span><span class="n">newIndividuals</span><span class="p">,</span><span class="n">ref_points</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span><span class="p">)</span>    <span class="c1"># reduces the size of newIndividuals to the population size         </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append_restart_file</span><span class="p">(</span><span class="n">individuals</span><span class="p">)</span>        <span class="c1"># Keep the last designs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append_history_file</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span><span class="n">individuals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pop_diversity</span><span class="p">,</span><span class="n">pop_dist</span><span class="p">,</span><span class="n">train_loss</span><span class="p">,</span><span class="n">test_loss</span><span class="p">,</span><span class="n">mse</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_folder_eval</span><span class="p">:</span>
                <span class="c1"># Delete the population folder</span>
                <span class="n">population_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimization_folder</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">__check_population_folder__</span><span class="p">(</span><span class="n">pop</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">population_folder</span><span class="p">):</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">population_folder</span><span class="p">)</span></div>
  

<div class="viewcode-block" id="NSGA3_ML.add_eval_parameters"><a class="viewcode-back" href="../../../modules/nsga3_ml.html#glennopt.optimizers.nsga3_ml.NSGA3_ML.add_eval_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">add_eval_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">eval_params</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="n">Parameter</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Add evaluation parameters. This is part of the initialization    </span>

<span class="sd">        Args:</span>
<span class="sd">            eval_params (List[Parameter]): Add in a list of evaluation parameters </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval_parameters</span> <span class="o">=</span> <span class="n">eval_params</span> <span class="c1"># Sets base class variable</span></div>

<div class="viewcode-block" id="NSGA3_ML.add_objectives"><a class="viewcode-back" href="../../../modules/nsga3_ml.html#glennopt.optimizers.nsga3_ml.NSGA3_ML.add_objectives">[docs]</a>    <span class="k">def</span> <span class="nf">add_objectives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">objectives</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="n">Parameter</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Add the objectives </span>

<span class="sd">        Args:</span>
<span class="sd">            objectives (List[Parameter]): [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objectives</span> <span class="o">=</span> <span class="n">objectives</span> <span class="c1"># Sets base class variable</span></div>

<div class="viewcode-block" id="NSGA3_ML.add_performance_parameters"><a class="viewcode-back" href="../../../modules/nsga3_ml.html#glennopt.optimizers.nsga3_ml.NSGA3_ML.add_performance_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">add_performance_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">performance_params</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="n">Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add performance parameters </span>

<span class="sd">        Args:</span>
<span class="sd">            performance_params (List[Parameter], optional): [description]. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">performance_parameters</span> <span class="o">=</span> <span class="n">performance_params</span> <span class="c1"># Sets base class variable</span></div>
    
<div class="viewcode-block" id="NSGA3_ML.start_doe"><a class="viewcode-back" href="../../../modules/nsga3_ml.html#glennopt.optimizers.nsga3_ml.NSGA3_ML.start_doe">[docs]</a>    <span class="k">def</span> <span class="nf">start_doe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">doe_individuals</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="n">Individual</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">doe_size</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Starts a design of experiments. This generates the parameters for the individuals to be evaluated and executes each case. If the DOE has already started and there is an output file for an individual then the individual won&#39;t be evaluated    </span>

<span class="sd">        Args:</span>
<span class="sd">            doe_individuals (List[Individual], optional): List of individuals. Defaults to None.</span>
<span class="sd">            doe_size (int, optional): [description]. Defaults to 128.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">doe_individuals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">doe_individuals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span><span class="n">doe_size</span><span class="p">):</span>
                <span class="n">parameters</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_parameters</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">eval_param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
                    <span class="n">eval_param</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">eval_param</span><span class="o">.</span><span class="n">min_value</span><span class="p">,</span><span class="n">eval_param</span><span class="o">.</span><span class="n">max_value</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">doe_individuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Individual</span><span class="p">(</span><span class="n">eval_parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span><span class="n">objectives</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">,</span> <span class="n">performance_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">performance_parameters</span><span class="p">))</span>
     
        <span class="c1"># * Begin the evaluation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_population</span><span class="p">(</span><span class="n">individuals</span><span class="o">=</span><span class="n">doe_individuals</span><span class="p">,</span><span class="n">population_number</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># * Read the DOE</span>
        <span class="n">individuals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_population</span><span class="p">(</span><span class="n">population_number</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_restart_file</span><span class="p">(</span><span class="n">individuals</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_folder_eval</span><span class="p">:</span> 
            <span class="c1"># Delete the population folder</span>
            <span class="n">population_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimization_folder</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">__check_population_folder__</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">population_folder</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">population_folder</span><span class="p">)</span></div>


<div class="viewcode-block" id="NSGA3_ML.__crossover_mutate__"><a class="viewcode-back" href="../../../modules/nsga3_ml.html#glennopt.optimizers.nsga3_ml.NSGA3_ML.__crossover_mutate__">[docs]</a>    <span class="k">def</span> <span class="nf">__crossover_mutate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">individuals</span><span class="p">:</span><span class="n">List</span><span class="p">[</span><span class="n">Individual</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;[summary]</span>

<span class="sd">        Args:</span>
<span class="sd">            individuals (List[Individual]): [description]</span>

<span class="sd">        Returns:</span>
<span class="sd">            [type]: [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nIndividuals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">individuals</span><span class="p">)</span>
        <span class="n">num_params</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">individuals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">eval_parameters</span><span class="p">)</span>        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutation_params</span><span class="o">.</span><span class="n">mutation_type</span> <span class="o">==</span> <span class="n">de_mutation_type</span><span class="o">.</span><span class="n">de_best_1_bin</span><span class="p">:</span>
            <span class="n">newIndividuals</span> <span class="o">=</span> <span class="n">de_best_1_bin</span><span class="p">(</span><span class="n">individuals</span><span class="o">=</span><span class="n">individuals</span><span class="p">,</span><span class="n">objectives</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">,</span>
                <span class="n">eval_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_parameters</span><span class="p">,</span><span class="n">performance_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">performance_parameters</span><span class="p">,</span>
                <span class="n">F</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutation_params</span><span class="o">.</span><span class="n">F</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutation_params</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutation_params</span><span class="o">.</span><span class="n">mutation_type</span> <span class="o">==</span> <span class="n">de_mutation_type</span><span class="o">.</span><span class="n">de_rand_1_bin</span><span class="p">:</span>
            <span class="n">newIndividuals</span> <span class="o">=</span> <span class="n">de_rand_1_bin</span><span class="p">(</span><span class="n">individuals</span><span class="o">=</span><span class="n">individuals</span><span class="p">,</span><span class="n">objectives</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">,</span>
                <span class="n">eval_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_parameters</span><span class="p">,</span><span class="n">performance_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">performance_parameters</span><span class="p">,</span>
                <span class="n">F</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutation_params</span><span class="o">.</span><span class="n">F</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutation_params</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutation_params</span><span class="o">.</span><span class="n">mutation_type</span> <span class="o">==</span> <span class="n">de_mutation_type</span><span class="o">.</span><span class="n">de_dmp</span><span class="p">:</span>
            <span class="n">newIndividuals</span> <span class="o">=</span> <span class="n">de_dmp</span><span class="p">(</span><span class="n">individuals</span><span class="o">=</span><span class="n">individuals</span><span class="p">,</span>
                <span class="n">objectives</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">,</span> <span class="n">eval_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_parameters</span><span class="p">,</span> <span class="n">performance_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">performance_parameters</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>               <span class="c1"># self.mutation_params.mutation_type == de_mutation_type.simple</span>
            <span class="n">nCrossover</span> <span class="o">=</span>  <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">nMutation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span><span class="o">-</span><span class="n">nCrossover</span>
            <span class="n">newIndividuals</span> <span class="o">=</span> <span class="n">simple</span><span class="p">(</span><span class="n">individuals</span><span class="o">=</span><span class="n">individuals</span><span class="p">,</span><span class="n">nCrossover</span><span class="o">=</span><span class="n">nCrossover</span><span class="p">,</span><span class="n">nMutation</span><span class="o">=</span><span class="n">nMutation</span><span class="p">,</span><span class="n">objectives</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">objectives</span><span class="p">,</span><span class="n">eval_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_parameters</span><span class="p">,</span><span class="n">performance_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">performance_parameters</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutation_params</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutation_params</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">newIndividuals</span></div></div>
    
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Paht Juangphanich.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>